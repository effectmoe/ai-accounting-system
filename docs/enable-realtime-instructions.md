---
title: Supabase OCR Resultsãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æœ‰åŠ¹åŒ–æ‰‹é †
created: 2025-07-06 17:59
updated: 2025-07-06 17:59
tags: [Supabase, ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ , OCR, è¨­å®šæ‰‹é †, ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°]
category: guide
author: Claude & tonychustudio
---

# Supabase OCR Resultsãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æœ‰åŠ¹åŒ–æ‰‹é †

## TL;DR

Supabaseã®ocr_resultsãƒ†ãƒ¼ãƒ–ãƒ«ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥ãŒå‹•ä½œã—ãªã„å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã®æ‰‹é †æ›¸ã€‚Supabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§3ã¤ã®è¨­å®šï¼ˆReplicationã€SQLå®Ÿè¡Œã€RLSç„¡åŠ¹åŒ–ï¼‰ã‚’è¡Œã†ã“ã¨ã§ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚æ‰€è¦æ™‚é–“ç´„5åˆ†ã€‚

## ç›®æ¬¡

- [å•é¡Œã®æ¦‚è¦](#å•é¡Œã®æ¦‚è¦)
- [è§£æ±ºæ‰‹é †](#è§£æ±ºæ‰‹é †)
  - [æ‰‹é †1: Supabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒ­ã‚°ã‚¤ãƒ³](#æ‰‹é †1-supabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒ­ã‚°ã‚¤ãƒ³)
  - [æ‰‹é †2: Replicationè¨­å®š](#æ‰‹é †2-replicationè¨­å®š)
  - [æ‰‹é †3: SQL Editorã§è¨­å®š](#æ‰‹é †3-sql-editorã§è¨­å®š)
  - [æ‰‹é †4: å‹•ä½œç¢ºèª](#æ‰‹é †4-å‹•ä½œç¢ºèª)
- [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
- [æœ¬ç•ªç’°å¢ƒã¸ã®é©ç”¨](#æœ¬ç•ªç’°å¢ƒã¸ã®é©ç”¨)

## å•é¡Œã®æ¦‚è¦

ç¾åœ¨ã®çŠ¶æ³ï¼š
- âœ… ãƒ‡ãƒ¼ã‚¿ã®æŒ¿å…¥ã¯æˆåŠŸ
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒªã‚¹ãƒŠãƒ¼ã¯æ­£å¸¸ã«èµ·å‹•
- âŒ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥ãŒå—ä¿¡ã•ã‚Œãªã„

åŸå› ï¼š
1. ocr_resultsãƒ†ãƒ¼ãƒ–ãƒ«ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‘ãƒ–ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å«ã¾ã‚Œã¦ã„ãªã„
2. REPLICA IDENTITYãŒè¨­å®šã•ã‚Œã¦ã„ãªã„
3. RLSãŒæœ‰åŠ¹ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã„ã‚‹å¯èƒ½æ€§

## è§£æ±ºæ‰‹é †

### æ‰‹é †1: Supabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒ­ã‚°ã‚¤ãƒ³

1. [Supabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰](https://app.supabase.com/project/clqpfmroqcnvyxdzadln)ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€Œclqpfmroqcnvyxdzadlnã€ã‚’ç¢ºèª

### æ‰‹é †2: Replicationè¨­å®š

1. **Database** â†’ **Replication** ã‚¿ãƒ–ã«ç§»å‹•
2. **supabase_realtime** ãƒ‘ãƒ–ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é¸æŠ
3. **Source** ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèª
4. **ocr_results** ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ¢ã™
   - âœ… ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹å ´åˆ â†’ æ‰‹é †3ã¸
   - âŒ ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„å ´åˆ â†’ ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚ªãƒ³ã«ã—ã¦ä¿å­˜

### æ‰‹é †3: SQL Editorã§è¨­å®š

1. **SQL Editor** ã‚¿ãƒ–ã«ç§»å‹•
2. æ–°ã—ã„ã‚¯ã‚¨ãƒªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã
3. ä»¥ä¸‹ã®SQLã‚’å®Ÿè¡Œï¼š

```sql
-- 1. RLSã‚’ä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ–ï¼ˆé–‹ç™ºç’°å¢ƒã®ã¿ï¼‰
ALTER TABLE public.ocr_results DISABLE ROW LEVEL SECURITY;

-- 2. REPLICA IDENTITYã‚’è¨­å®š
ALTER TABLE public.ocr_results REPLICA IDENTITY FULL;

-- 3. ãƒ‘ãƒ–ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«è¿½åŠ ï¼ˆæ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ãŒç„¡è¦–ï¼‰
ALTER PUBLICATION supabase_realtime ADD TABLE public.ocr_results;

-- 4. è¨­å®šç¢ºèª
SELECT 
  tablename,
  pubname,
  'Realtime Enabled' as status
FROM pg_publication_tables 
WHERE tablename = 'ocr_results' 
  AND pubname = 'supabase_realtime';
```

4. **Run** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å®Ÿè¡Œ
5. çµæœã« `ocr_results | supabase_realtime | Realtime Enabled` ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

### æ‰‹é †4: å‹•ä½œç¢ºèª

1. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’2ã¤é–‹ã

**ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1ï¼ˆãƒªã‚¹ãƒŠãƒ¼ï¼‰:**
```bash
cd /Users/tonychustudio/Documents/aam-orchestration/accounting-automation
node simple_realtime_test.js
```

**ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2ï¼ˆãƒ‡ãƒ¼ã‚¿æŒ¿å…¥ï¼‰:**
```bash
cd /Users/tonychustudio/Documents/aam-orchestration/accounting-automation
node test_ocr_realtime.js --insert
```

2. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1ã«ä»¥ä¸‹ã®ã‚ˆã†ãªé€šçŸ¥ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸï¼š
```
ğŸ”” ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡ï¼
ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—: INSERT
ãƒ‡ãƒ¼ã‚¿: { ... }
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥ãŒå—ä¿¡ã•ã‚Œãªã„å ´åˆ

1. **Supabaseã®è¨­å®šã‚’å†ç¢ºèª**
   - Replicationã‚¿ãƒ–ã§ocr_resultsãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã‹
   - SQL Editorã§è¨­å®šç¢ºèªã‚¯ã‚¨ãƒªã‚’å†å®Ÿè¡Œ

2. **ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢**
   - Supabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ãƒªãƒ­ãƒ¼ãƒ‰
   - è¨­å®šã‚’å†åº¦ç¢ºèª

3. **ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å†èµ·å‹•**
   - ä¸¡æ–¹ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢ï¼ˆCtrl+Cï¼‰
   - å†åº¦å®Ÿè¡Œ

### ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åˆ¥å¯¾å‡¦æ³•

- `relation "ocr_results" is already part of the publication`
  â†’ æ­£å¸¸ã€‚æ—¢ã«ãƒ‘ãƒ–ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å«ã¾ã‚Œã¦ã„ã‚‹

- `permission denied`
  â†’ Service Roleã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ç¢ºèª

## æœ¬ç•ªç’°å¢ƒã¸ã®é©ç”¨

é–‹ç™ºç’°å¢ƒã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãŒå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªå¾Œï¼š

1. **RLSã‚’å†åº¦æœ‰åŠ¹åŒ–**
```sql
ALTER TABLE public.ocr_results ENABLE ROW LEVEL SECURITY;
```

2. **é©åˆ‡ãªRLSãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆ**
```sql
-- ä¼šç¤¾ã”ã¨ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
CREATE POLICY "company_isolation" ON public.ocr_results
  FOR ALL 
  USING (company_id = auth.jwt() ->> 'company_id');

-- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç”¨ã®èª­ã¿å–ã‚Šæ¨©é™
CREATE POLICY "realtime_read" ON public.ocr_results
  FOR SELECT
  USING (true);
```

3. **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®æ›´æ–°**
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®è¿½åŠ 
- å†æ¥ç¶šãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…
- æ¥ç¶šçŠ¶æ…‹ã®ç›£è¦–

## é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- `/simple_realtime_test.js` - ã‚·ãƒ³ãƒ—ãƒ«ãªãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ†ã‚¹ãƒˆ
- `/test_ocr_realtime.js` - å®Œå…¨ãªãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«
- `/complete_realtime_setup.sql` - è¨­å®šç”¨SQLã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `/app/documents/page.tsx` - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å®Ÿè£…æ¸ˆã¿ã®ãƒšãƒ¼ã‚¸