---
title: Google Apps Script OCR セットアップガイド
created: 2025-07-05 12:00
updated: 2025-07-05 12:00
tags: [GAS, OCR, Google Drive, AI会計, セットアップ]
category: guide
author: Claude & tonychustudio
---

# Google Apps Script OCR セットアップガイド

## TL;DR

Google Apps Script (GAS) を使用して無料でPDF/画像のOCR処理を実現するセットアップガイドです。API利用料金なしで日本語OCRが可能になり、スキャンPDFも処理できます。所要時間約15分。

## 目次

- [概要](#概要)
- [前提条件](#前提条件)
- [ステップ1: GASプロジェクトの作成](#ステップ1-gasプロジェクトの作成)
- [ステップ2: コードの配置](#ステップ2-コードの配置)
- [ステップ3: Drive APIの有効化](#ステップ3-drive-apiの有効化)
- [ステップ4: Webアプリとしてデプロイ](#ステップ4-webアプリとしてデプロイ)
- [ステップ5: 環境変数の設定](#ステップ5-環境変数の設定)
- [ステップ6: 動作確認](#ステップ6-動作確認)
- [トラブルシューティング](#トラブルシューティング)
- [メンテナンス](#メンテナンス)

## 概要

このガイドでは、Google Apps Scriptを使用してOCR APIを構築する手順を説明します。

### メリット
- ✅ **無料**: Google Cloud Vision APIと異なり、利用料金が発生しません
- ✅ **日本語対応**: 高精度な日本語OCRが可能
- ✅ **スキャンPDF対応**: 画像として保存されたPDFも処理可能
- ✅ **簡単セットアップ**: 15分程度で完了

### 制限事項
- ⚠️ 処理時間: 5-10秒程度かかる場合があります
- ⚠️ ファイルサイズ: 50MB以下推奨
- ⚠️ 同時処理数: Googleアカウントの制限に依存

## 前提条件

- Googleアカウント
- AI会計システムがVercelにデプロイ済み
- 基本的なコピー&ペースト操作ができること

## ステップ1: GASプロジェクトの作成

### 1.1 Google Apps Scriptにアクセス

1. ブラウザで [script.google.com](https://script.google.com) を開く
2. Googleアカウントでログイン

### 1.2 新規プロジェクト作成

1. 「新しいプロジェクト」ボタンをクリック
2. プロジェクト名を「AI会計OCR」に変更
   - 左上の「無題のプロジェクト」をクリック
   - 「AI会計OCR」と入力してEnter

## ステップ2: コードの配置

### 2.1 既存コードの削除

エディタに表示されている以下のコードを全て削除：
```javascript
function myFunction() {
  
}
```

### 2.2 OCRコードの貼り付け

`/docs/gas-ocr-script.gs` の内容を全てコピーして貼り付け

### 2.3 保存

- Ctrl+S（Windows）またはCmd+S（Mac）で保存
- または、ファイル → 保存

## ステップ3: Drive APIの有効化

### 3.1 サービスの追加

1. 左サイドバーの「サービス」（＋マーク）をクリック
2. 「Drive API」を見つけてクリック
3. 「追加」ボタンをクリック

### 3.2 確認

- 左サイドバーに「Drive」が表示されることを確認

## ステップ4: Webアプリとしてデプロイ

### 4.1 デプロイ設定

1. 右上の「デプロイ」ボタンをクリック
2. 「新しいデプロイ」を選択

### 4.2 デプロイタイプの選択

1. 歯車アイコンをクリック
2. 「ウェブアプリ」を選択

### 4.3 設定項目

| 項目 | 設定値 |
|------|--------|
| 説明 | AI会計OCR API v1.0 |
| 次のユーザーとして実行 | 自分 |
| アクセスできるユーザー | 全員 |

### 4.4 デプロイ実行

1. 「デプロイ」ボタンをクリック
2. 権限の確認画面が表示された場合：
   - 「アクセスを承認」をクリック
   - Googleアカウントを選択
   - 「詳細」→「AI会計OCR（安全ではないページ）に移動」
   - 「許可」をクリック

### 4.5 URLの取得

デプロイ完了画面に表示される「ウェブアプリ」のURLをコピー

例：
```
https://script.google.com/macros/s/AKfycbwXXXXXXXXXXXXXXXXXXXXXXXXX/exec
```

## ステップ5: 環境変数の設定

### 5.1 Vercelダッシュボードにアクセス

1. [vercel.com](https://vercel.com) にログイン
2. AI会計システムのプロジェクトを選択

### 5.2 環境変数の追加

1. Settings → Environment Variables
2. 以下の環境変数を追加：

| Key | Value |
|-----|-------|
| GAS_OCR_URL | コピーしたGAS WebアプリのURL |

3. 「Save」をクリック

### 5.3 再デプロイ

1. Deployments タブに移動
2. 最新のデプロイメントの「...」メニューから「Redeploy」を選択
3. 「Redeploy」ボタンをクリック

## ステップ6: 動作確認

### 6.1 GAS APIの確認

ブラウザでGAS WebアプリのURLにアクセスし、以下の画面が表示されることを確認：

```
📄 GAS OCR API
✅ APIは正常に動作しています
```

### 6.2 AI会計システムでの確認

1. AI会計システムにアクセス
2. PDFまたは画像ファイルをアップロード
3. OCR処理が実行されることを確認

## トラブルシューティング

### エラー: 「スクリプトが見つかりません」

**原因**: デプロイが正しく完了していない

**解決方法**:
1. GASプロジェクトに戻る
2. デプロイ → デプロイを管理
3. 「編集」→「新バージョン」でバージョンを更新

### エラー: 「権限がありません」

**原因**: アクセス権限の設定ミス

**解決方法**:
1. デプロイ設定で「アクセスできるユーザー」が「全員」になっているか確認
2. 再度デプロイを実行

### OCR結果が文字化けする

**原因**: 日本語フォントの認識問題

**解決方法**:
1. より鮮明な画像/PDFを使用
2. 解像度を300dpi以上に設定

## メンテナンス

### 一時ファイルのクリーンアップ

GASエディタで以下を実行（月1回推奨）：

```javascript
cleanupTempFiles()
```

### バージョンアップ

新機能追加時：
1. コードを更新
2. デプロイ → デプロイを管理
3. 「編集」→「新バージョン」
4. 変更内容を記載してデプロイ

## 次のステップ

### Google Drive MCP連携

さらに強力な連携のため、Google Drive MCPサーバーの設定も検討してください：

1. 領収書の自動保存
2. 会計書類の自動整理
3. Googleスプレッドシートとの連携

詳細は `/docs/gdrive-mcp-setup.md` を参照してください。