# Web Speech API音声入力機能実装

## 概要
AIチャットダイアログにWeb Speech APIを使用した日本語音声認識機能を実装しました。

## 実装ファイル

### 1. 型定義
- **ファイル**: `/types/speech-recognition.ts`
- **内容**: Web Speech APIのTypeScript型定義

### 2. カスタムフック
- **ファイル**: `/hooks/use-speech-recognition.ts`
- **内容**: 音声認識機能を管理するReactフック

### 3. UIコンポーネント統合
- **ファイル**: `/components/ai-chat-dialog.tsx`
- **変更内容**: 音声入力ボタンと状態表示を追加

## 機能仕様

### 音声認識設定
- **言語**: 日本語 (ja-JP)
- **継続認識**: 無効 (手動制御)
- **中間結果**: 有効 (リアルタイム表示)
- **最大候補**: 1つ

### UI要素
1. **マイクボタン**
   - 位置: テキスト入力フィールドと送信ボタンの間
   - 機能: 音声認識の開始/停止
   - アイコン: 認識中は `MicOff`、停止中は `Mic`
   - 色: 認識中は赤色（destructive）、停止中は枠線のみ（outline）

2. **視覚的フィードバック**
   - 認識中: ボタンがアニメーション（pulse）
   - 入力フィールド: 認識中は背景が赤っぽく変化
   - プレースホルダー: 認識中は「音声を認識中...」

3. **ステータス表示**
   - 音声認識中: 赤いマイクアイコンと「音声を認識中...」メッセージ
   - 中間結果: 「認識中: [テキスト]」として青色で表示

### ブラウザサポート
- **対応ブラウザ**: Chrome, Edge, Safari（最新版）
- **非対応時**: マイクボタンは表示されない
- **エラーメッセージ**: 分かりやすい日本語のエラー説明

### エラーハンドリング
- `not-allowed`: マイクアクセス拒否時の詳細説明
- `no-speech`: 音声未検出時の対処法
- `audio-capture`: マイクデバイス問題の対処法
- `network`: ネットワークエラーの説明
- `service-not-allowed`: HTTPS要件の説明

## 使用方法

### 1. ユーザー操作
1. AIチャットダイアログを開く
2. マイクボタンをクリックして音声認識を開始
3. マイクアクセス許可のダイアログが表示された場合は「許可」をクリック
4. 音声で内容を話す
5. 話し終わったらマイクボタンをクリックして停止
6. 認識されたテキストが入力フィールドに自動入力される
7. 送信ボタンで送信

### 2. セキュリティ要件
- **HTTPS接続**: 音声認識はHTTPS環境でのみ動作
- **マイクアクセス許可**: ユーザーの明示的な許可が必要
- **プライバシー**: 音声データはローカルで処理され、外部に送信されない

## 技術詳細

### Web Speech API設定
```typescript
{
  continuous: false,        // 手動制御のため無効
  interimResults: true,     // リアルタイム表示のため有効
  language: 'ja-JP',       // 日本語設定
  maxAlternatives: 1       // 最も可能性の高い結果のみ
}
```

### 状態管理
- `isListening`: 音声認識の状態
- `transcript`: 確定された認識結果
- `interimTranscript`: 認識中の中間結果
- `error`: エラーメッセージ
- `isSupported`: ブラウザサポート状況

### 自動機能
- **テキスト同期**: 音声認識結果は自動的に入力フィールドに反映
- **エラー統合**: 音声認識エラーはチャットのエラー表示と統合
- **状態連携**: 音声認識中は送信ボタンが無効化

## 今後の改善案

1. **音声コマンド**: 「送信」など特定の単語による自動送信
2. **音量表示**: 音声入力レベルの視覚的表示
3. **言語切替**: 複数言語への対応
4. **音声フィードバック**: 認識結果の音声読み上げ
5. **ショートカット**: キーボードショートカットでの音声認識開始

## 動作確認

### テスト項目
- [ ] ブラウザサポート確認
- [ ] マイクアクセス許可
- [ ] 音声認識精度
- [ ] エラーハンドリング
- [ ] UI/UXの使いやすさ
- [ ] HTTPS環境での動作
- [ ] モバイルブラウザでの動作

### 推奨テスト環境
- **ブラウザ**: Chrome 94+, Edge 94+, Safari 14.1+
- **接続**: HTTPS
- **デバイス**: マイク付きPC/スマートフォン
- **環境**: 静かな場所での測定