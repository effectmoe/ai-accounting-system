<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ååˆºOCRç›´æ¥ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        .container { 
            display: flex; 
            gap: 20px; 
        }
        .section { 
            flex: 1; 
            border: 1px solid #ddd; 
            padding: 20px; 
            border-radius: 5px; 
        }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin-top: 10px;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .result { 
            background: #f5f5f5; 
            padding: 15px; 
            border-radius: 5px; 
            margin-top: 15px; 
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .address-highlight {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .field-value {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ååˆºOCR APIç›´æ¥ãƒ†ã‚¹ãƒˆ</h1>
    <p>APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ä½æ‰€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è©³ç´°ã«ç¢ºèªã—ã¾ã™</p>
    
    <div class="container">
        <div class="section">
            <h2>1. ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h2>
            <input type="file" id="fileInput" accept="image/*">
            <br>
            <button onclick="testOCR()" id="testBtn">OCRãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div id="status"></div>
        </div>
        
        <div class="section">
            <h2>2. APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆç”Ÿãƒ‡ãƒ¼ã‚¿ï¼‰</h2>
            <div id="rawResponse" class="result"></div>
        </div>
        
        <div class="section">
            <h2>3. ä½æ‰€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è§£æ</h2>
            <div id="addressAnalysis"></div>
        </div>
    </div>

    <script>
        async function testOCR() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            const status = document.getElementById('status');
            const rawResponse = document.getElementById('rawResponse');
            const addressAnalysis = document.getElementById('addressAnalysis');
            const button = document.getElementById('testBtn');
            
            if (!file) {
                alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            button.disabled = true;
            status.textContent = 'ğŸ”„ OCRå‡¦ç†ä¸­...';
            rawResponse.textContent = '';
            addressAnalysis.innerHTML = '';
            
            try {
                const formData = new FormData();
                formData.append('image', file);
                
                const baseUrl = window.location.hostname === 'localhost' 
                    ? 'http://localhost:3002' 
                    : 'https://accounting-automation-am691fbss-effectmoes-projects.vercel.app';
                
                console.log('ğŸ“¡ APIå‘¼ã³å‡ºã—:', baseUrl + '/api/ocr/business-card');
                
                const response = await fetch(baseUrl + '/api/ocr/business-card', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                // ç”Ÿãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
                rawResponse.textContent = JSON.stringify(data, null, 2);
                
                if (data.success) {
                    status.textContent = 'âœ… OCRå‡¦ç†æˆåŠŸ';
                    status.className = 'success';
                    
                    // ä½æ‰€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è§£æ
                    let analysisHtml = '<div class="address-highlight">';
                    analysisHtml += '<h3>ğŸ  ä½æ‰€é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤</h3>';
                    
                    const addressFields = {
                        'postalCode': 'éƒµä¾¿ç•ªå·',
                        'prefecture': 'éƒ½é“åºœçœŒ',
                        'city': 'å¸‚åŒºç”ºæ‘',
                        'address1': 'ç•ªåœ°',
                        'address2': 'å»ºç‰©åãƒ»éš',
                        'address': 'ä½æ‰€ï¼ˆçµ±åˆï¼‰'
                    };
                    
                    for (const [field, label] of Object.entries(addressFields)) {
                        const value = data[field];
                        const displayValue = value || 'âŒ null/undefined';
                        const className = value ? 'field-value' : 'field-value error';
                        
                        analysisHtml += `
                            <div style="margin: 8px 0;">
                                <strong>${label} (${field}):</strong> 
                                <span class="${className}">${displayValue}</span>
                            </div>
                        `;
                    }
                    
                    // ä½æ‰€ãŒå–å¾—ã§ãã¦ã„ã‚‹ã‹ã®åˆ¤å®š
                    const hasAnyAddress = data.prefecture || data.city || data.address1 || data.address;
                    
                    analysisHtml += `
                        <div style="margin-top: 15px; padding: 10px; background: ${hasAnyAddress ? '#d4edda' : '#f8d7da'}; border-radius: 5px;">
                            <strong>åˆ¤å®š:</strong> ${hasAnyAddress ? 'âœ… ä½æ‰€ãƒ‡ãƒ¼ã‚¿ã‚ã‚Š' : 'âŒ ä½æ‰€ãƒ‡ãƒ¼ã‚¿ãªã—'}
                        </div>
                    `;
                    
                    analysisHtml += '</div>';
                    
                    // ãã®ä»–ã®å–å¾—ãƒ‡ãƒ¼ã‚¿
                    analysisHtml += '<div style="margin-top: 20px;">';
                    analysisHtml += '<h3>ğŸ“‹ ãã®ä»–ã®å–å¾—ãƒ‡ãƒ¼ã‚¿</h3>';
                    analysisHtml += `<div>ä¼šç¤¾å: <span class="field-value">${data.companyName || 'æœªå–å¾—'}</span></div>`;
                    analysisHtml += `<div>ä¼šç¤¾åã‚«ãƒŠ: <span class="field-value">${data.companyNameKana || 'æœªå–å¾—'}</span></div>`;
                    analysisHtml += `<div>æ‹…å½“è€…å: <span class="field-value">${data.name || 'æœªå–å¾—'}</span></div>`;
                    analysisHtml += `<div>é›»è©±ç•ªå·: <span class="field-value">${data.phone || 'æœªå–å¾—'}</span></div>`;
                    analysisHtml += `<div>ãƒ¡ãƒ¼ãƒ«: <span class="field-value">${data.email || 'æœªå–å¾—'}</span></div>`;
                    analysisHtml += '</div>';
                    
                    addressAnalysis.innerHTML = analysisHtml;
                    
                } else {
                    status.textContent = 'âŒ OCRå‡¦ç†å¤±æ•—';
                    status.className = 'error';
                    addressAnalysis.innerHTML = '<div class="error">ã‚¨ãƒ©ãƒ¼: ' + (data.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼') + '</div>';
                }
                
            } catch (error) {
                console.error('ã‚¨ãƒ©ãƒ¼:', error);
                status.textContent = 'âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ';
                status.className = 'error';
                rawResponse.textContent = error.toString();
            } finally {
                button.disabled = false;
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚
        window.onload = function() {
            console.log('ğŸ¯ ååˆºOCRç›´æ¥ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸');
            console.log('ğŸ“ ã“ã®ãƒšãƒ¼ã‚¸ã§APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ä½æ‰€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è©³ç´°ã«ç¢ºèªã§ãã¾ã™');
        };
    </script>
</body>
</html>